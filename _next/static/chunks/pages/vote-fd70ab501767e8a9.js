(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1786],{36739:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote",function(){return t(22509)}])},23696:function(e,n){"use strict";n.Z=[{inputs:[{internalType:"string",name:"question",type:"string"},{internalType:"string",name:"imgUrl",type:"string"}],name:"createPoll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"getAllPollResults",outputs:[{components:[{internalType:"string",name:"name",type:"string"},{internalType:"uint256",name:"yesCount",type:"uint256"},{internalType:"uint256",name:"noCount",type:"uint256"},{internalType:"string",name:"imgUrl",type:"string"}],internalType:"struct Voting.pollsListObj[]",name:"",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"pollIndex",type:"uint256"}],name:"getPollResults",outputs:[{internalType:"uint256",name:"yes",type:"uint256"},{internalType:"uint256",name:"no",type:"uint256"},{internalType:"uint256",name:"CurrentIndex",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getPollsCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"polls",outputs:[{internalType:"string",name:"question",type:"string"},{internalType:"string",name:"imgUrl",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"pollIndex",type:"uint256"},{internalType:"bool",name:"choice",type:"bool"}],name:"vote",outputs:[],stateMutability:"nonpayable",type:"function"}]},94158:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return y}});var s=t(11527),i=t(50959),a=t(65155),l=t(19788),r=t(40533),c=t(86415),o=t(998),u=t(50574),p=t(71329),d=t(48310),m=t(23696);function y(e){let{open:n,setVoteFormOpen:t,dispatchContract:y,isPending:x,isConfirming:g,isConfirmed:f}=e,{isOpen:h,onOpen:j,onOpenChange:b,onClose:N}=(0,a.q)(),[C,v]=(0,i.useState)(""),[T,k]=(0,i.useState)("");return(0,i.useEffect)(()=>{n&&j(),f&&n&&t(!1),console.log(f,"isConfirmed")},[n,f]),(0,s.jsx)("div",{children:(0,s.jsx)(l.R,{backdrop:"opaque",isOpen:h,hideCloseButton:g||x,isDismissable:!1,onOpenChange:b,onClose:()=>{t(!1),N()},classNames:{backdrop:"bg-gradient-to-t from-zinc-900 to-zinc-900/10 backdrop-opacity-20"},children:(0,s.jsx)(r.A,{children:e=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.k,{className:"flex flex-col gap-1",children:"创建投票"}),(0,s.jsxs)(o.I,{children:[(0,s.jsx)(u.Y,{type:"text",label:"投票名称",onValueChange:e=>{v(e)}}),(0,s.jsx)(u.Y,{type:"text",label:"投票图片链接",onValueChange:e=>{k(e)}})]}),(0,s.jsx)(p.R,{className:"justify-center",children:(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)(d.A,{isLoading:x||g,className:"w-unit-7xl mb-3",color:"primary",onPress:()=>{y({abi:m.Z,address:"0x0d77736F42EF631771550Ec616D202c4dc2A530B",functionName:"createPoll",args:[C,T]})},children:x||g?"交易确认中...":"确认创建"})})})]})})})})}},22509:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return v}});var s=t(11527),i=t(50959),a=t(81684),l=t(72472),r=t(27378),c=t(28208),o=t(65155),u=t(48310),p=t(62562),d=t(59078),m=t(73080),y=t(72550),x=t(19788),g=t(40533),f=t(86415),h=t(998),j=t(22851),b=t(71329),N=t(23696),C=t(94158);function v(){let{address:e}=(0,a.m)(),{data:n,writeContract:t,isPending:v,error:T}=(0,l.S)(),{isLoading:k,isSuccess:E,isError:w}=(0,r.A)({hash:n}),{data:A,refetch:_,isFetching:F}=(0,c.u)({abi:N.Z,address:"0x0d77736F42EF631771550Ec616D202c4dc2A530B",functionName:"getAllPollResults"}),[P,O]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(T||E)&&(S(),_())},[T,E]);let M=async e=>{let{abi:n,address:s,functionName:i,args:a}=e;t({abi:n,address:s,functionName:i,args:a})},{isOpen:R,onOpen:S,onOpenChange:q}=(0,o.q)();return(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(u.A,{color:"primary",className:"w-unit-6xl mb-3",onClick:e=>{O(!0)},children:"创建新投票"}),null==A?void 0:A.map((e,n)=>(0,s.jsxs)(p.w,{className:"py-4 mb-3",children:[(0,s.jsx)(d.u,{className:"pb-0 pt-2 px-4 flex-col items-start",children:(0,s.jsx)("h4",{className:"font-bold text-large",children:e.name})}),(0,s.jsx)(m.G,{className:"overflow-visible py-2",children:(0,s.jsx)(y.J,{alt:"Card background",className:"object-cover rounded-xl",src:e.imgUrl,width:270})}),(0,s.jsxs)("div",{className:"justify-center flex mb-1",children:[(0,s.jsxs)("span",{className:"mr-5",children:["赞成数:",(0,s.jsx)("span",{children:e.yesCount.toString()})]}),(0,s.jsxs)("span",{children:["反对数:",(0,s.jsx)("span",{children:e.noCount.toString()})]})]}),(0,s.jsxs)("div",{className:"justify-center flex",children:[(0,s.jsx)(u.A,{isLoading:v||k,size:"sm",color:"primary",className:"mr-5",onClick:()=>{M({abi:N.Z,address:"0x0d77736F42EF631771550Ec616D202c4dc2A530B",functionName:"vote",args:[n,!0]}),S()},children:v||k?"交易确认中...":"赞成"}),(0,s.jsx)(u.A,{size:"sm",color:"danger",onClick:()=>{M({abi:N.Z,address:"0x0d77736F42EF631771550Ec616D202c4dc2A530B",functionName:"vote",args:[n,!1]}),S()},children:v||k?"交易确认中...":"反对"})]})]},n)),(0,s.jsx)(x.R,{backdrop:"opaque",isOpen:R,hideCloseButton:k||v,isDismissable:!1,onOpenChange:q,classNames:{backdrop:"bg-gradient-to-t from-zinc-900 to-zinc-900/10 backdrop-opacity-20"},children:(0,s.jsx)(g.A,{children:e=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.k,{className:"flex flex-col gap-1",children:"处理结果"}),(0,s.jsx)(h.I,{children:T?(0,s.jsx)("p",{children:T.shortMessage||T.message}):E?"交易已确认。":(0,s.jsx)(j.c,{})}),(0,s.jsx)(b.R,{children:v||k?null:(0,s.jsx)(u.A,{color:"primary",onPress:e,isLoading:v||k,children:"确定"})})]})})}),(0,s.jsx)(C.default,{open:P,setVoteFormOpen:O,dispatchContract:M,isPending:v,isConfirming:k,isConfirmed:E})]})}}},function(e){e.O(0,[1748,7488,2888,9774,179],function(){return e(e.s=36739)}),_N_E=e.O()}]);